---
layout: post
title: Guide to APA with groff ms and refer
date: 2025-02-20
categories: groff, ms, refer, macro, tmac, APA, style guide, pdf
permalink: /groff-apa
---

# Table of Contents <a name=tableofcontents></a>

[Preface](/groff-apa#preface)

[Introduction](/groff-apa#introduction)

[Prerequisites](/groff-apa#prerequisites)

[Cover Page](/groff-apa#coverpage)

[Page Numbering](/groff-apa#pagenumbering)

[Font](/groff-apa#font)
- [Font Family](/groff-apa#fontfamily)
  - [Default Fonts](/groff-apa#defaultfonts)
  - [Custom Fonts](/groff-apa#customfonts)
- [Font Size](/groff-apa#fontsize)
- [Font Style](/groff-apa#fontstyle)
- [Line Spacing](/groff-apa#linespacing)

[In-text Citation](/groff-apa#intextcitation)
- [Parenthetical Citation](/groff-apa#parentheticalcitation)
- [Narrative Citation](/groff-apa#narrativecitation)

[Reference List](/groff-apa#referencelist)
- [Formatting the Heading](/groff-apa#formattingtheheading)
- [Authors, Ands & Ampersands](/groff-apa#authorsandsampersands)
  - [Effect on Citations](/groff-apa#effectoncitations)
- [Space Between Entries](/groff-apa#spacebetweenentries)
- [Period Suppression](/groff-apa#periodsuppression)

[Exporting as PDF](/groff-apa#exportingaspdf)

# Preface <a name=preface></a>

I think every student who has been through college has had to write an essay with citations and referencing for all their sources for a mandatory prerequisite class, and I was no exception to this.

Just as a fun little challenge, I wanted to write my essay using [Neovim](https://neovim.io), the same terminal text-editor I code on and write blogs for my website with, so I had to find a word processor that can compile documents from plaintext (unlike What-You-See-Is-What-You-Get (WYSIWYG) word processors, such as [LibreOffice](https://www.libreoffice.org) [Writer](https://www.libreoffice.org/discover/writer)). As you could tell from the title of this blog post, I chose to use [`groff`](https://www.gnu.org/software/groff) for that task.

You do not have to be using APA to find this guide helpful, as it goes through where many of the things that you will need to change are and explains how to change them. Just adapt some of the specific changes made in this guide to suit your needs.

This blog guide mainly just serves to compile all the relevant research I had done into a simple step-by-step solution I can easily follow when I want to use `groff` to write essays in APA again, but it also hopes to help others who were in the same spot I was save themselves some time and frustration that I had to go through when figuring things out by myself for the first time.

I made a [Github repository](https://github.com/de-soot/groff-apa) as a companion to this guide. It gives an example of the final generated output so you know exactly what you are going to get out of this. The source files included in the repository have some extra comments to help readability and can also be used as a template to quickly set things up to just get started writing.

A fun little fact about this blog post: this is actually my second time writing this blog post because I lost the first one after almost finishing it.

# Introduction <a name=introduction></a>

The [American Psychological Association](https://apa.org) (APA) 7th Edition [style guide](https://apastyle.apa.org) is the most popular for formatting references and citations in college-level essays (at least that was what my lecturer said when they gave out the writing assignment).

[GNU](https://gnu.org) [(t)roff](https://troff.org) (abbreviated as `groff`) is an older and more lightweight but less well-known typesetting alternative to [LaTeX](https://www.latex-project.org) (which is popular for writing academic papers) that comes preinstalled in most [GNU/Linux](https://en.wikipedia.org/wiki/GNU/Linux_naming_controversy) distributions. If it was not for the massive size of a LaTeX install (>2GB vs. `groff`'s <10MB), I likely would not have used `groff`. `groff` also has a simpler syntax and compiles in an instant compared to LaTeX, which are some of the things that further convinced me to stick with `groff` even when I got stuck and lost at times.

The `ms` macro is largely seen as the "default" macro for writing to PDF in `groff`, so it should have the most documentation out of any other macros. That was the main reason I chose to use the `ms` macro, along with already having previous experience writing basic documents with the `ms` macro.

However, `groff` by itself cannot do citations and referencing out-of-the-box. Fortunately, it does come with a preprocessor called `refer` that does the citing and referencing for it (although, the defaults for `refer` do not conform to APA guidelines). Luckily, it is not too complex to change those defaults to match any style guide as long as you know where to find the right things to change.

# Prerequisites <a name=prerequisites></a>

This guide assumes you are using a GNU/Linux-based system and already know how to write and compile basic `groff ms` documents to Portable Document Format (PDF). If not, do not worry. There are many resources online for getting started, such as Luke Smith's videos on [`groff`](https://videos.lukesmith.xyz/w/eDqgKby1W4sHQGZgqZbMLe) and [`refer`](https://videos.lukesmith.xyz/w/5ANbTYv7cgF69FhpAkVBwi). For more detail, see GNU's official [manual](https://www.gnu.org/software/groff/manual/groff.html) or `troff`'s [HOWTO](https://troff.org/TheGroffFriendsHowto.pdf).

# Cover Page <a name=coverpage></a>

My assignment did not require me to include a cover page, but yours might. Although it is standard for cover page information to be on its own separate page, `groff` does not conform to that standard by default. Luckily, the `ms` macro does have a convenient to change this easily. Just put [`.RP no`](https://linux.die.net/man/7/groff_ms) as the first line of your document (`.RP` stands for "report"; the `no` argument tells it to not repeat the cover page information on the next page):

```
.RP no
```

This is also needed for the next section on page numbering.

# Page Numbering <a name=pagenumbering></a>

The first page does not have any headers (including page numbering) because `groff` expects it to include cover page information (i.e. the title of the paper; optionally author(s), institution(s), date, and abstract).

If you followed the steps on the previous section on the cover page, you might be confused as to why the first page after the cover page still does not have any page numbering while the page after it starts with the page numbering of '2'. This is because although `groff` started counting page numbers on the first page after the cover page, it still suppresses the first page by default.

When we used the `.RP no` macro to move the cover page information into its own page, we simply created a new "page 0" that `groff` does not know about (which is also why `groff` does not count it in the page numbering).

Conveniently, is another macro to help us fix this. Place `.P1` below `.RP no` to unsuppress the first page header (page numbering):

```
.RP no
.P1
```

Note that `.P1` does not work by itself without `.RP no`, likely because `groff` suppresses headers on any page with cover page information even if you make them empty by doing this:

```
.TL
.AB no
.AE
```

which works because even though the title (`.TL`) is required, it stops at the abstract (`.AB`, which ends at `.AE`; the `no` argument suppresses the error/warning it gives when its empty).

# Font <a name=font></a>

Probably the most widely accepted font for writing essays has got to be Times New Roman in 12 point size. This section covers how to change the font family, size, style, and line spacing.

## Font Family <a name=fontfamily></a>

By default, `groff` outputs text in your [device's default serif font family](https://www.gnu.org/software/groff/manual/groff.html.node/Using-Fonts.html) (typically Times New Roman). This is a sensible default for most things, but in my experience, you sometimes may have to change your font to suit your lecturer's tastes.

### Default Fonts <a name=defaultfonts></a>

Changing to another one of the default fonts in `groff` is simple.

This is how to change it to device's default [sans-serif](https://www.gnu.org/software/groff/manual/groff.html.node/Font-Families.html),

```
.fam H \" Helvetica
```

monospace,

```
.fam C \" Courier
```

and (back to) serif font family:

```
.fam T \" Times New Roman
```

There are many other default fonts in `groff` listed in [this post](https://technicallywewrite.com/2024/04/12/changefonts).

### Custom Fonts <a name=customfonts></a>

This one is trickier, and I still have not been able to get it to work on my device yet. I did find a [guide that seemed promising](https://www.port.de/cgi-bin/groff/AddingFonts) though. Maybe I will revisit this in the future, if I get it working.

## Font Size <a name=fontsize></a>

The default font size in `groff` is a little bit less than 12pt ([10pt](https://www.gnu.org/software/groff/manual/groff.html.node/Manipulating-Type-Size-and-Vertical-Spacing.html) to be exact), but it is very easy to change. Simply add this line to your plaintext document:

```
.nr PS 12
```

As for what `PS` stands for, it probably means something like "Point Size"; `.nr` stands for "Number Registers".

## Font Style <a name=fontstyle></a>

Here is how to make your text **bold**,

```
.ft B
```

*italicised*,

```
.ft I
```

or even ***both***!

```
.ft BI
```

And to set it back to normal:

```
.ft R \" Stands for Regular or Roman
```

## Line Spacing <a name=linespacing></a>

All parts of an APA-styled paper should be double-spaced according to [this](https://apastyle.apa.org/style-grammar-guidelines/paper-format/line-spacing). By default, `groff` uses [120% of font size](https://www.gnu.org/software/groff/manual/groff.html.node/Manipulating-Type-Size-and-Vertical-Spacing.html) as vertical spacing. Fortunately, changing this to double-spacing is just as simple as changing the font size: just set the vertical spacing (`.nr VS`) to double your font size (`.nr PS`).

```
.nr VS 24
```

# In-text Citation <a name=intextcitation></a>

It is finally about time to start getting into the actual citations after all that setting-up.

`refer` uses numbered footnotes by default, but APA wants the author(s) and date included in their in-text citations. This section will cover how to do exactly as APA says.

## Parenthetical Citation <a name=parentheticalcitation></a>

After some research, I found a [blog post "no-tears" guide](https://preciouschicken.com/blog/posts/no-tears-references-groff), 2 [Github](https://github.com/Koshkov/groff-paper-template) [repositories](https://github.com/skurtulmus/refer-styles), and a post from the [GNU mailing list](https://lists.gnu.org) (which I cannot seem to find anymore). I extracted the `refer` block (denoted by `.R1` and `.R2`) from all those sources and combined them to make a frankenstein that works perfectly for most APA parenthetical citations:

```
.R1 \" Refer block start
database ref.bib # Path to refer bibliography file from current working directory (can be absolute directory)
accumulate # Prints References at end of the document (same as `-e` argument for `refer`)
move-punctuation # Ensures citations appear before punctuations (same as `-P` argument for `refer`)
sort A+ # Sorts References in alphabetical order
label "(A1?(A1.n(A3?' et al.':A2&' & 'A2.n)):Q)', '(D.y|D)" # "Author(s), Date" format for parenthetical citation (joins author names using '&' if 2 authors; appends 'et. al.' if 3 or more)
bracket-label " (" ) "; " # (same as `-S` argument for `refer`)
no-label-in-reference # Do not display (Author(s), Date) like footnotes in reference list
.R2 \" Refer block end
```

## Narrative Citation <a name=narrativecitation></a>

My lecturer luckily did not require me to use narrative citations, but yours might. If you do have to use narrative citation, unfortunately, `refer` does not have any support for narrative citations being alongside parenthetical citations. While it is possible to repurpose the citation formatting part of the `refer` block to change it from parenthetical to narrative, it would still not be possible to have both narrative and parenthetical citation on the same page.

The only somewhat practical solution I see to this problem is to keep the `refer` block as-is and write the narrative citations manually. This will require you to have a separate document for producing the referencing for the narrative citations, because `refer` will not make entries for them in the reference list as it will not recognise the narrative citations that you manually typed in, treating them like ordinary text. This also means that you need to generate 2 separate output PDFs and extract the correct reference list from the one without narrative citations to merge with the other one that does. Any PDF-editing tool can be used for this, but the best free and open-source one that I found was [PDFArranger](https://github.com/pdfarranger/pdfarranger).

# Reference List <a name=referencelist></a>

This section is where we start to dive into `refer`'s code (usually located inside either `/usr/share/groff/current/tmac` or `/usr/local/share/groff/current/tmac`). Rest assured, the changes that will be made will not be very complicated as long as you know 3 things: what to change, what to change them to, and where to find them (all 3 being what I had to figure out on my own by reading and tinkering with the source code).

## Formatting the Heading <a name=formattingtheheading></a>



## Authors, Ands & Ampersands <a name=authorsandsampersands></a>



### Effect on Citations <a name=effectoncitations></a>



## Space Between Entries <a name=spacebetweenentries></a>



## Period Suppression <a name=periodsuppression></a>



# Exporting as PDF <a name=exportingaspdf></a>



<script src="https://giscus.app/client.js"
        data-repo="de-soot/de-soot.github.io"
        data-repo-id="R_kgDOK6_5tA"
        data-category="Announcements"
        data-category-id="DIC_kwDOK6_5tM4CflCT"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
